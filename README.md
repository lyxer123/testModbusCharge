# 工控测试软件

这是一个基于Python tkinter创建的工控测试软件，具有可调整大小的界面和完整的菜单系统，支持Modbus协议测试和27930充电桩协议测试。

## 功能特性

- **可调整大小的界面**：窗口默认大小为显示器窗口的一半，支持拖拽调整大小
- **现代化菜单系统**：
  - 测试菜单：包含"modbus测试"、"modbus解析对码"和"27930测试"三个子菜单
  - 关于菜单：包含"本软件"子菜单
- **Tab页面设计**：使用Tab控件分别显示Modbus测试和27930测试页面
- **响应式设计**：界面元素会随窗口大小自动调整
- **状态栏**：实时显示应用状态和窗口大小信息
- **现代化样式**：使用clam主题和自定义样式

### Modbus协议支持
- 完整的Modbus RTU协议实现
- CRC16校验码计算和验证
- 支持所有标准Modbus功能码（01-06, 15-16）
- 实时数据解析和显示
- 手动CRC测试功能

### 27930充电桩协议支持
- 基于GB/T 27930-2015标准
- 完整的CAN数据包处理
- 支持多种充电协议消息类型
- 实时数据解析和验证

## 系统要求

- Python 3.6 或更高版本
- Windows 10/11
- tkinter库（Python标准库，通常已预装）
- 必要的Python包：pyserial, pyinstaller

## 安装和运行

### 方法一：源码运行
1. 确保您的系统已安装Python
2. 安装依赖包：
```bash
pip install pyserial
pip install pyinstaller
```
3. 下载或克隆此项目到本地
4. 在项目目录中运行：
```bash
python main.py
```

### 方法二：使用编译后的exe文件
1. 下载编译后的 `dist/工控测试软件.exe` 文件
2. 双击运行即可（无需安装Python环境）

### 方法三：使用启动器
1. 双击 `工控测试软件启动器.bat` 文件
2. 选择运行模式：
   - 测试模式：检查exe文件并测试运行（5秒后自动关闭）
   - 正常运行：直接启动工控测试软件

## 编译说明

### 编译环境要求
- Python 3.6+
- Windows 10/11
- 必要的Python包：pyserial, pyinstaller

### 编译步骤
1. 安装依赖：
```bash
pip install pyserial
pip install pyinstaller
```

2. 编译项目：
```bash
pyinstaller testModbusCharge.spec
```

3. 运行程序：
编译完成后，可执行文件位于 `dist/工控测试软件.exe`

### 编译状态：✅ 成功

#### 编译信息
- **编译时间**：2025年
- **目标平台**：Windows 10/11
- **Python版本**：3.12.10
- **PyInstaller版本**：6.15.0

#### 生成文件
- **可执行文件**：`dist/工控测试软件.exe` (约10MB)
- **文件状态**：✅ 已生成
- **控制台窗口**：❌ 已隐藏（GUI模式）

#### 包含功能
1. **Modbus测试功能**
   - 串口配置和通信
   - 多种功能码支持（01-06, 15-16）
   - 实时数据显示
   - 定时扫描

2. **Modbus解析对码**
   - 数据格式解析
   - 注释管理
   - 数据导出

3. **27930测试**（预留功能）

## 使用说明

### 菜单功能

1. **测试菜单**
   - **modbus测试**：启动Modbus测试功能
   - **modbus解析对码**：打开Modbus数据解析窗口
   - **27930测试**：启动27930测试功能
   - **退出**：关闭应用程序

2. **关于菜单**
   - **本软件**：显示应用程序的详细信息

### Modbus功能

#### Modbus测试页面
- **串口设置**：配置串口参数（串口号、波特率、数据位、停止位、校验位）
- **Modbus功能设置**：选择功能码、设置从站地址、寄存器地址和数量
- **数据显示**：实时显示原始数据和解码数据
- **CRC测试**：手动输入数据进行CRC计算和验证

#### Modbus解析对码窗口
- **数据解析**：输入十六进制数据进行Modbus协议解析
- **CRC校验**：自动验证数据包的CRC校验码
- **注释管理**：为解析结果添加自定义注释
- **数据导出**：导出解析结果和注释

### 27930充电桩测试功能

#### 27930测试页面
- **CAN接口设置**：配置CAN设备、波特率、通道等参数
- **27930功能设置**：选择消息类型、设置发送方和接收方地址
- **扫描功能**：支持定时扫描，可设置扫描间隔
- **数据显示**：实时显示原始CAN数据和27930协议解析结果

#### 支持的消息类型
- 充电握手
- 充电参数配置
- 充电状态
- 充电统计
- 充电停止
- 自定义消息

#### 技术特性
- 基于GB/T 27930-2015标准
- 完整的CAN数据包处理
- 支持多种数据格式显示
- 实时数据解析和验证

### 界面操作

- **调整窗口大小**：拖拽窗口边缘或角落来调整大小
- **Tab页面切换**：点击不同的Tab标签页来切换测试功能
- **菜单Tab联动**：点击菜单中的"modbus测试"或"27930测试"会自动选中对应的Tab页面
- **状态栏**：底部状态栏显示当前操作状态和窗口尺寸

## 文件结构

```
testModbusCharge/
├── dist/
│   └── 工控测试软件.exe          # 编译后的可执行文件
├── build/                        # 编译临时文件
├── main.py                       # 主程序源码
├── modbus_parser.py             # Modbus解析模块
├── test_27930.py                # 27930功能测试脚本
├── demo_27930.py                # 27930功能演示脚本
├── testModbusCharge.spec        # PyInstaller配置
├── 工控测试软件启动器.bat        # 启动器脚本
├── requirements.txt              # 依赖包列表
├── modbus_annotations.json      # Modbus注释数据文件
└── config/                      # 配置目录
```

## 技术细节

- **GUI框架**：tkinter (Python标准GUI库)
- **布局管理**：Grid布局管理器，支持响应式设计
- **事件处理**：窗口大小改变事件监听
- **样式主题**：clam主题 + 自定义样式
- **串口通信**：pyserial
- **数据格式**：JSON (注释数据)
- **打包工具**：PyInstaller
- **目标格式**：Windows EXE

## 兼容性

- ✅ Windows 10
- ✅ Windows 11
- ✅ 64位系统
- ✅ 32位系统（理论上支持）

## 注意事项

1. **首次运行**：可能需要几秒钟启动时间
2. **串口权限**：某些操作可能需要管理员权限
3. **杀毒软件**：可能会误报，需要添加信任
4. **依赖文件**：所有依赖已打包到exe中，无需额外安装
5. **CAN设备连接**：确保CAN设备正确连接并驱动已安装
6. **波特率设置**：确保CAN设备波特率与目标设备匹配
7. **地址配置**：根据实际充电桩配置设置正确的地址
8. **数据格式**：注意数据格式的一致性

## 故障排除

### 常见问题

1. **程序无法启动**
   - 检查是否安装了所有依赖包
   - 确保Python版本兼容

2. **串口无法打开**
   - 检查串口是否被其他程序占用
   - 确认串口号是否正确
   - 检查串口驱动是否正常

3. **数据解析错误**
   - 确认数据格式是否正确
   - 检查功能码是否匹配

4. **CAN设备连接问题**
   - 确保CAN设备正确连接并驱动已安装
   - 检查波特率设置是否匹配

## 测试建议

1. 在目标机器上测试运行
2. 检查串口功能是否正常
3. 验证数据解析功能
4. 测试界面响应性
5. 验证CAN设备连接和通信

## 部署说明

1. 将 `dist/工控测试软件.exe` 复制到目标机器
2. 确保目标机器有串口驱动（如需要）
3. 双击运行即可使用

## 维护信息

- **源码位置**：`main.py`, `modbus_parser.py`
- **配置文件**：`testModbusCharge.spec`
- **重新编译**：运行 `pyinstaller testModbusCharge.spec`

## 自定义和扩展

### 添加新功能

您可以在`ModernUI`类中添加新的方法来扩展功能：

```python
def new_feature(self):
    """新功能实现"""
    # 在这里添加您的功能代码
    pass
```

### 修改样式

在`apply_modern_style`方法中可以自定义界面样式：

```python
def apply_modern_style(self):
    style = ttk.Style()
    # 自定义样式配置
    style.configure("Custom.TButton", 
                   background="#your_color",
                   font=("your_font", 12))
```

### 添加图标

要添加应用图标，请准备一个名为`test_icon.ico`的文件放在项目根目录中。程序会自动加载这个图标文件。

## 版本信息

- 版本：1.0
- 编译时间：2025年
- 支持平台：Windows 10/11
- 开发者：lyxer123
- 协议标准：GB/T 27930-2015

## 许可证

此项目为开源项目，可自由使用和修改。

## 联系方式

如有问题或建议，请联系开发者 lyxer123。

---

## 编译完成！🎉

您的工控测试软件已成功编译为exe文件，可以独立运行在Windows系统上。 